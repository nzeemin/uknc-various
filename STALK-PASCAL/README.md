# STALK-PASCAL Восстановленный исходник "Сталкера" на Паскале

Здесь лежит STALK1.PAS - это восстановленный исходник игры, которая называлась "Сталкер" или "Зона" (файл игры назывался
STALK.SAV, PIKNIK.SAV или ZONA.SAV) и предназначалась для советских PDP11-совместимых машин - таких как ДВК и УКНЦ.
Это игра в жанре рогалик (Rogue-like), бродилка по подземельям, по мотивам повести Стругацких "Пикник на обочине".

Игра, по-видимому, создана в конце 1980-х, автор игры - неизвестный программист из Ульяновска - первоначально программа писала копирайт:
<code>*** (С)УЛЬЯНОВСК УЛПИ "ГОЛОГРАФИЯ"***</code>

Сначала был восстановлен код игры в виде файла на MACRO-11 - см. [STALK.MAC](https://github.com/nzeemin/uknc-various/blob/master/STALK/STALK.MAC), до компиляции байт-в-байт.
Затем уже из ассемблера был восстановлен исходник на Паскале.

Оригинальный исполнимый файл был сильно пропатчен - исправлены какие-то огрехи, текст был переделан в КОИ-8. Поэтому для побайтового сравнения с оригиналом пришлось патчить строки - см. программу StalkPatcher.

Последовательность сборки (см. !compilelink.bat):
 - Компилируется RANDU.MAC -> RANDU.OBJ - это всего одна процедура из библиотеки Фортрана (FORLIB.OBJ), используется для генерации случайных чисел.
 - Компилятор Паскаля из исходника STALK1.PAS создаёт файл STALK1.MAC.
 - StalkPatcher преобразует STALK1.MAC в STALK1P.MAC, исправляя кодировку строк и вставляя в строки спецсимволы.
 - В начало STALK1P.MAC подставляется BLK000.INC - отвечает за патчинг начального блока игры, получается STALKP.MAC.
 - Компиляция STALKP.MAC через MACRO.
 - Компоновка: <code>LINK/STACK:1000 STALKP,FRANDU,PASCAL</code>, получается готовый STALK1.SAV

Спасибо участникам форума zx-pk.ru за помощь и поддержку в процессе восстановления!
